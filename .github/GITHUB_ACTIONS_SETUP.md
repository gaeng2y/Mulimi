# 🚀 GitHub Actions UseCase 테스트 설정 가이드

## 📋 개요
이 문서는 Mulimi 프로젝트에서 PR이 생성될 때 자동으로 UseCase 레이어의 단위 테스트를 실행하고 결과를 댓글로 남기는 GitHub Actions 설정 방법을 설명합니다.

## 🗂️ 파일 구조
```
.github/
├── workflows/
│   ├── pr-usecase-tests.yml          # 기본 워크플로우
│   └── pr-usecase-tests-enhanced.yml # 향상된 워크플로우 (추천)
├── scripts/
│   └── parse-test-results.py         # 테스트 결과 파싱 스크립트
└── GITHUB_ACTIONS_SETUP.md          # 이 파일
```

## ⚙️ 필수 설정

### 1. Repository 권한 설정
GitHub 저장소 설정에서 다음 권한을 활성화해야 합니다:

1. **Settings** → **Actions** → **General**
2. **Workflow permissions**에서 다음 선택:
   - ✅ `Read and write permissions`
   - ✅ `Allow GitHub Actions to create and approve pull requests`

### 2. Branch Protection Rules (선택사항)
`main` 또는 `develop` 브랜치 보호를 위해:

1. **Settings** → **Branches**
2. **Add rule** 클릭
3. Branch name pattern: `main` (또는 `develop`)
4. **Require status checks to pass before merging** 체크
5. **Require branches to be up to date before merging** 체크
6. Status checks에서 `🧪 Domain Layer Tests` 선택

## 🎯 워크플로우 선택

### 기본 워크플로우 (`pr-usecase-tests.yml`)
- 간단한 bash 스크립트 기반
- 빠른 실행
- 기본적인 테스트 결과 표시

### 향상된 워크플로우 (`pr-usecase-tests-enhanced.yml`) - **추천**
- Python 스크립트 기반 정확한 결과 파싱
- 상세한 실패 정보 제공
- 시각적 진행률 표시
- 테스트 리포트 아티팩트 생성

## 🔧 사용 방법

### 1. 워크플로우 활성화
선택한 워크플로우 파일을 저장소에 커밋하면 자동으로 활성화됩니다.

```bash
git add .github/
git commit -m "🚀 Add UseCase tests GitHub Action"
git push origin main
```

### 2. PR 생성 시 자동 실행
다음 경로의 파일이 변경된 PR에서 자동 실행됩니다:
- `Project/Domain/**` - Domain 레이어 소스
- `Project/Data/**` - Data 레이어 소스  
- `.github/workflows/**` - 워크플로우 파일
- `Tuist/**` - Tuist 설정 파일

### 3. 테스트 결과 확인
PR에 자동으로 댓글이 달리며 다음 정보를 제공합니다:
- 📊 테스트 요약 (총 테스트 수, 성공/실패 수)
- 📈 성공률 및 진행률 바
- 🔍 실패한 테스트 상세 정보
- ⏰ 실행 시간

## 🎨 댓글 예시

### 성공 시
```markdown
## ✅ UseCase Layer Test Results

📊 Test Summary:
- Total Tests: 15
- Passed: 15 ✅
- Failed: 0 ❌
- Success Rate: 100.0%

Progress: 🟢🟢🟢🟢🟢🟢🟢🟢🟢🟢

Status: All Tests Passed

---
🤖 Generated by GitHub Actions | 🧪 Domain Layer Tests | ⏰ 2025-01-XX XX:XX:XX
```

### 실패 시
```markdown
## ❌ UseCase Layer Test Results

📊 Test Summary:
- Total Tests: 15
- Passed: 12 ✅
- Failed: 3 ❌
- Success Rate: 80.0%

Progress: 🟢🟢🟢🟢🟢🟢🟢🟢🔴🔴

Status: Some Tests Failed

## 🔍 Failed Tests Details

❌ DrinkWaterUseCaseTests.testDrinkWaterFailure
```
Test failed due to mock repository error...
```

---
🤖 Generated by GitHub Actions | 🧪 Domain Layer Tests | ⏰ 2025-01-XX XX:XX:XX
```

## 🔍 트러블슈팅

### 1. "Permission denied" 에러
**해결방법**: Repository Settings에서 Actions 권한을 "Read and write permissions"로 변경

### 2. Tuist 설치 실패
**해결방법**: `.mise.toml` 파일에서 Tuist 버전 확인 및 업데이트

### 3. 시뮬레이터 관련 에러
**해결방법**: 워크플로우에서 destination을 다른 iOS 버전으로 변경
```yaml
-destination 'platform=iOS Simulator,name=iPhone 15,OS=17.0'
```

### 4. 테스트 결과 파싱 실패
**해결방법**: `parse-test-results.py` 스크립트의 정규식 패턴 확인

## 📈 성능 최적화

### 1. 캐싱 활용
```yaml
- name: Cache Tuist Dependencies
  uses: actions/cache@v4
  with:
    path: |
      ~/.tuist/Cache
      Tuist/Dependencies
    key: ${{ runner.os }}-tuist-${{ hashFiles('Tuist/Package.swift') }}
```

### 2. 병렬 테스트 실행
```yaml
-parallel-testing-enabled YES
-parallel-testing-worker-count 4
```

### 3. 조건부 실행
특정 파일만 변경된 경우에만 실행하도록 `paths` 필터 조정

## 🎯 고급 기능

### 1. Slack 알림 추가
```yaml
- name: Notify Slack
  if: failure()
  uses: 8398a7/action-slack@v3
  with:
    status: failure
    webhook_url: ${{ secrets.SLACK_WEBHOOK }}
```

### 2. 테스트 커버리지 리포트
```yaml
-enableCodeCoverage YES
```

### 3. 다중 iOS 버전 테스트
```yaml
strategy:
  matrix:
    ios-version: ['17.0', '17.2']
```

## 📞 지원

문제가 발생하면 다음 단계를 따르세요:
1. GitHub Actions 탭에서 실행 로그 확인
2. 아티팩트에서 상세 테스트 결과 다운로드
3. Issue 생성 시 관련 로그 첨부

---

🚀 **Happy Testing with GitHub Actions!** 🧪